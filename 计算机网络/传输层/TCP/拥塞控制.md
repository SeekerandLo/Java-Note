## TCP 拥塞控制算法

> 所谓拥塞控制就是防止过多的数据注入到网络当中，这样可以使网络中的路由器或链路不至于过载。拥塞控制是一个全局性的过程，涉及到路由器，主机已经与降低网络传输性能有关的所有因素。

&emsp;&emsp;与流量控制的区别是拥塞控制是全局性的过程，调控整个网络方面的性能，而流量控制是针对点对点的，是两端之间调控的措施，即抑制发送端发送数据的速率，以便于接收方接收到数据。

## 算法

&emsp;&emsp;拥塞控制是基于窗口控制的算法，需要在发送方维护一个拥塞窗口(cwnd)的状态变量，由于不知道网络中的实际情况，所以发送方在发送时，会根据拥塞窗口来控制发送窗口，让发送窗口等于拥塞窗口，当网络中没有拥塞的时候，拥塞窗口可以再增大一点，以便发送更多的分组，如果网络中出现了拥塞，就将拥塞窗口减小一点，以缓和网络中的拥塞情况。

### 慢开始

&emsp;&emsp;从小到大增大发送窗口，即由小到大增大发送方的拥塞窗口数值，发送方每接收到一个接受发的确认后都将拥塞窗口增加1，每经过一个传输轮次，拥塞窗口就加倍。

&emsp;&emsp;传输轮次，把拥塞窗口所允许发送的报文都连续发送出去，并收到对己方发送的最后一个字节的确认。简单来说，就是发送几个，到收到几个确认经历的时间。

&emsp;&emsp;为了防止拥塞窗口增长过大引起网络拥塞，所以需要设置一个慢开始门限，ssthresh 状态变量。ssthresh 的用法：
- 当 cwnd < ssthresh 时，使用慢开始算法

- 当 cwnd > ssthresh 时，使用拥塞避免算法

- 当 cwnd = ssthresh 时，二者都可使用

### 拥塞避免

&emsp;&emsp;拥塞避免算法的思路是使拥塞窗口缓慢增大，每经过一个往返时间 RTT 就让拥塞窗口加 1，而不是像慢开始那样加倍增大。

&emsp;&emsp;拥塞避免说是把拥塞窗口控制为线性规律增长，使网络不容易出现拥塞。

### 快重传

&emsp;&emsp;使用快重传算法能让发送发尽早的知道个别报文段的丢失。快重传算法要求接受方不要等待自己在发送数据时才捎带确认，而是立即发送确认，即收到失序的报文段后立马向发送方发送已经收到报文段的重复确认。

&emsp;&emsp;快重传算法规定，发送方只要一连收到3个重复确认，就知道接受方没有收到某个报文段，因此立即进行重传(即“快重传”)，这样就不会出现超时，发送方也不会认为出现网络拥塞而重新开始慢开始。

### 快恢复

&emsp;&emsp;在施行快重传之后，发送方发现只是丢失某个报文段，于是不会启动慢开始，而是执行“快恢复”，将门限值调整为 ssthresh/2，同时设置拥塞窗口也是 ssthresh / 2，并开始拥塞避免算法。